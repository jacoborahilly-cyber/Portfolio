<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Walk-Through Portfolio</title>
    <style>
        /* Base Setup */
        body { 
            overflow: hidden; 
            margin: 0; 
            padding: 0; 
            background-color: #121212; 
            font-family: Arial, sans-serif; 
            color: #E0E0E0;
        }

        #world { 
            position: absolute; 
            width: 5000px;      
            height: 5000px;     
            top: 0; 
            left: 0;
            
            /* --- UPDATED: Custom Image Background --- */
            background-image: url('thinkiwassmart.jpg'); 
            background-repeat: no-repeat;
            background-size: 5000px 5000px;
            background-position: top left;
        }
        
        .room-content { 
            position: absolute; 
            width: 1000px;
            min-height: 700px;
            padding: 30px; 
            border-radius: 12px; 
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7); 
            color: #121212;
            z-index: 3;
            transition: opacity 1s;
        }
        
        /* Room Styles */
        #Room-Spawn { top: 2000px; left: 2000px; background-color: #34495E; color: white; }
        #Room-Design { top: 500px; left: 500px; background-color: #FF5A5F; }
        #Room-Code { top: 3500px; left: 3500px; background-color: #1ABC9C; }
        #Room-About { top: 2500px; left: 500px; background-color: #F39C12; }
        
        /* Hidden content when transitioning */
        .content-hidden {
            opacity: 0 !important;
            pointer-events: none;
        }

        /* --- Camera Reticle (Fixed White circle) --- */
        #camera-reticle {
            position: fixed;
            top: 50%;
            left: 50%;
            width: 15px; 
            height: 15px;
            margin-top: -7.5px;
            margin-left: -7.5px;
            border-radius: 50%;
            background-color: white; 
            z-index: 1000;
            pointer-events: none; 
            box-shadow: 0 0 5px rgba(255, 255, 255, 0.7);
        }

        /* --- Door Styles within Spawn Room --- */
        .door-visual {
            position: absolute;
            width: 100px;
            height: 150px;
            background-color: #7F8C8D;
            border: 5px solid #2C3E50;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #2C3E50;
            transition: transform 0.3s;
        }
        .door-visual:hover {
            transform: scale(1.05);
        }

        /* --- Fixed Info Panel (For About Section) --- */
        #info-panel-fixed {
            position: fixed;
            top: 50%;
            right: 0;
            transform: translateY(-50%);
            width: 300px;
            height: 80vh;
            background-color: rgba(255, 255, 255, 0.95);
            color: #121212;
            border-left: 5px solid #F39C12;
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
            right: -305px; 
            transition: right 0.4s ease-out;
        }
        #info-panel-fixed.open {
            right: 0;
        }
        #info-panel-fixed button {
            float: right;
            border: none;
            background: none;
            font-size: 1.5em;
            cursor: pointer;
        }

        /* --- Interactive Objects in About Room --- */
        .interactive-object {
            position: absolute;
            width: 80px;
            height: 80px;
            background-color: #E74C3C;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5em;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s;
        }
        .interactive-object:hover {
            transform: scale(1.1);
        }

        /* --- Fixed Instructions (unchanged) --- */
        #instructions-fixed {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 10px 15px;
            background-color: rgba(0, 0, 0, 0.7);
            color: #f0f0f0;
            border-radius: 5px;
            z-index: 1002;
            font-size: 1.1em;
        }
        
    </style>
</head>
<body>

    <div id="instructions-fixed">
        Use **WASD** to walk through a door and begin an experience!
    </div>
    
    <div id="camera-reticle"></div> 

    <div id="info-panel-fixed">
        <button id="close-info-panel" onclick="document.getElementById('info-panel-fixed').classList.remove('open');">&times;</button>
        <h3 id="panel-title"></h3>
        <div id="panel-content"></div>
    </div>
    
    <div id="world">
        <section id="Room-Spawn" class="room-content" data-room-id="Spawn"></section>
        
        <section id="Room-Design" class="room-content content-hidden" data-template="room-design-template" data-room-id="Design"></section>
        <section id="Room-Code" class="room-content content-hidden" data-template="room-code-template" data-room-id="Code"></section>
        <section id="Room-About" class="room-content content-hidden" data-template="room-about-template" data-room-id="About"></section>

        <div id="spawn-center" style="position: absolute; top: 2500px; left: 2500px; width: 1px; height: 1px;"></div>
    </div>
    
    <template id="room-spawn-template">
        <h2>üè† Welcome to the Hub!</h2>
        <p>Walk toward any of the doors to enter a portfolio section.</p>

        <div class="door-visual" data-target-room="Design" data-hallway-x="1000" data-hallway-y="850" 
             style="top: 0px; left: 450px;">DESIGN</div>

        <div class="door-visual" data-target-room="Code" data-hallway-x="4000" data-hallway-y="3850" 
             style="bottom: 0px; left: 450px;">CODE</div>
        
        <div class="door-visual" data-target-room="About" data-hallway-x="1000" data-hallway-y="2850" 
             style="top: 275px; left: 0px;">ABOUT</div>

        <div class="door-visual" data-target-room="empty1" data-hallway-x="3000" data-hallway-y="1000" 
             style="top: 275px; right: 0px;">ART</div>
             
    </template>
    
    <template id="room-design-template">
        <h2>üé® Design Hallway</h2>
        <p>You walked through the door! Walk back toward the center to return to the Hub.</p>
    </template>
    <template id="room-code-template">
        <h2>üíª Code Hallway</h2>
        <p>Walk back to the center of this room to return to the Hub.</p>
    </template>
    
    <template id="room-about-template">
        <h2>üë§ About Me</h2>
        <p>Explore the floating objects to learn more about my skills, tools, and background.</p>

        <div class="interactive-object" data-title="My Experience" data-content="I have 5 years of experience in product design and front-end development." style="top: 150px; left: 100px;">üíº</div>
        <div class="interactive-object" data-title="Tool: Figma" data-content="Figma is my primary tool for high-fidelity prototyping and UI/UX design." style="top: 400px; left: 250px;">üìê</div>
        <div class="interactive-object" data-title="Skill: JavaScript" data-content="I specialize in ES6+, React, and animated interactions using modern APIs." style="top: 250px; left: 500px;">üíª</div>
        <div class="interactive-object" data-title="Contact" data-content="Email me at: contact@example.com" style="top: 550px; left: 700px;">üìß</div>
        <div class="interactive-object" data-title="Future Goals" data-content="I plan to transition into a full-stack role focusing on scalable server architecture." style="top: 300px; left: 300px;">üöÄ</div>
        
        <div style="position: absolute; bottom: 30px; left: 50px; background-color: rgba(0,0,0,0.5); padding: 10px; border-radius: 5px; color: white;">
            Press **E** to return to the Hub
        </div>
    </template>


    <script>
        const world = document.getElementById('world');
        const roomContent = document.querySelectorAll('.room-content');
        const infoPanel = document.getElementById('info-panel-fixed');
        const panelTitle = document.getElementById('panel-title');
        const panelContent = document.getElementById('panel-content');
        
        const WORLD_SIZE = 5000;
        const ROOM_WIDTH = 1000;
        const ROOM_HEIGHT = 700;
        const DOOR_WIDTH = 100;
        const DOOR_HEIGHT = 150;

        // Camera Position Variables
        let targetX = 0; 
        let targetY = 0;
        let currentX = 0;
        let currentY = 0;
        const easing = 0.08; 

        // Current State
        let currentRoomId = 'Spawn'; 
        const SPAWN_ROOM_WORLD_X = 2000;
        const SPAWN_ROOM_WORLD_Y = 2000;
        const SPAWN_COORD = { x: SPAWN_ROOM_WORLD_X + ROOM_WIDTH / 2, y: SPAWN_ROOM_WORLD_Y + ROOM_HEIGHT / 2 }; // Center of spawn room in World Space
        let isTransitioning = false;

        // WASD Movement
        const baseSpeed = 0.5;      
        const maxSpeed = 15;        
        const accelerationRate = 1.05; 
        let currentSpeed = baseSpeed;
        const keyMap = {};
        const movementKeys = ['KeyW', 'KeyA', 'KeyS', 'KeyD', 'ArrowUp', 'ArrowLeft', 'ArrowDown', 'ArrowRight'];

        // --- Core Scene Management ---

        function loadRoomTemplates() {
            // Load Spawn and Hallway templates
            const spawnSection = document.getElementById('Room-Spawn');
            if (spawnSection.children.length === 0) {
                 const template = document.getElementById('room-spawn-template');
                 const clone = document.importNode(template.content, true);
                 spawnSection.appendChild(clone);
            }
            document.querySelectorAll('section[data-template]').forEach(roomElement => {
                const templateId = roomElement.getAttribute('data-template');
                const template = document.getElementById(templateId);
                if (template && roomElement.children.length === 0) {
                    const clone = document.importNode(template.content, true);
                    roomElement.appendChild(clone);
                }
            });
            // Attach specific listeners after templates are loaded
            attachAboutListeners();
        }

        function setRoomVisibility(targetId) {
            // Hide info panel when changing rooms
            infoPanel.classList.remove('open');

            roomContent.forEach(room => {
                if (room.id === 'Room-' + targetId) {
                    room.classList.remove('content-hidden');
                } else {
                    room.classList.add('content-hidden');
                }
            });
        }

        function goToScene(targetSceneId, targetWorldX, targetWorldY) {
            if (isTransitioning) return;
            isTransitioning = true;

            // 1. Calculate the new target camera position (translation)
            const viewportCenterX = window.innerWidth / 2;
            const viewportCenterY = window.innerHeight / 2;
            
            targetX = viewportCenterX - targetWorldX;
            targetY = viewportCenterY - targetWorldY;

            // 2. Hide content before moving
            document.getElementById('Room-' + currentRoomId).classList.add('content-hidden');

            // 3. Update current room state
            currentRoomId = targetSceneId;

            // 4. Show the new room content after transition has mostly completed
            setTimeout(() => {
                setRoomVisibility(targetSceneId);
                // Allow movement after a short delay
                setTimeout(() => { isTransitioning = false; }, 500);
            }, 1000); 
        }

        // --- About Room Interactions ---
        function handleObjectHover(e) {
            // Only show panel if in the About room
            if (currentRoomId === 'About') {
                panelTitle.textContent = e.currentTarget.getAttribute('data-title');
                panelContent.innerHTML = `<p>${e.currentTarget.getAttribute('data-content')}</p>`;
                infoPanel.classList.add('open');
            }
        }
        
        function attachAboutListeners() {
            const aboutRoom = document.getElementById('Room-About');
            if (aboutRoom) {
                const objects = aboutRoom.querySelectorAll('.interactive-object');
                objects.forEach(obj => {
                    obj.addEventListener('mouseover', handleObjectHover);
                });
            }
        }


        // --- Collision Detection ---
        function checkCollisions() {
            if (isTransitioning) return;

            // Calculate the current world coordinate of the *center of the viewport*
            const cameraWorldX = (window.innerWidth / 2) - currentX;
            const cameraWorldY = (window.innerHeight / 2) - currentY;
            
            const RETURN_DOOR_RADIUS = 200; 

            if (currentRoomId === 'Spawn') {
                // Logic: Check if the camera has walked into any of the doors in the Spawn Room

                const spawnRoomElement = document.getElementById('Room-Spawn');
                const doorVisuals = spawnRoomElement.querySelectorAll('.door-visual');

                doorVisuals.forEach(door => {
                    const targetRoom = door.getAttribute('data-target-room');
                    const hallwayX = parseInt(door.getAttribute('data-hallway-x'));
                    const hallwayY = parseInt(door.getAttribute('data-hallway-y'));
                    
                    // Door position relative to the Spawn Room corner (2000, 2000)
                    let doorLeft = parseFloat(door.style.left || 0);
                    let doorTop = parseFloat(door.style.top || 0);
                    let doorRight = parseFloat(door.style.right || 0);
                    let doorBottom = parseFloat(door.style.bottom || 0);
                    
                    let doorWorldCenterX, doorWorldCenterY;

                    // Calculate World X Center
                    if (door.style.right) {
                         doorWorldCenterX = SPAWN_ROOM_WORLD_X + ROOM_WIDTH - doorRight - DOOR_WIDTH / 2;
                    } else { 
                         doorWorldCenterX = SPAWN_ROOM_WORLD_X + doorLeft + DOOR_WIDTH / 2;
                    }

                    // Calculate World Y Center
                    if (door.style.bottom) {
                         doorWorldCenterY = SPAWN_ROOM_WORLD_Y + ROOM_HEIGHT - doorBottom - DOOR_HEIGHT / 2;
                    } else { 
                         doorWorldCenterY = SPAWN_ROOM_WORLD_Y + doorTop + DOOR_HEIGHT / 2;
                    }

                    const DOOR_COLLISION_RADIUS = 75; 
                    const distanceToDoor = Math.sqrt(
                        Math.pow(cameraWorldX - doorWorldCenterX, 2) + 
                        Math.pow(cameraWorldY - doorWorldCenterY, 2)
                    );
                    
                    if (distanceToDoor < DOOR_COLLISION_RADIUS) {
                        goToScene(targetRoom, hallwayX, hallwayY);
                    }
                });

            } else {
                // Logic: Check if the camera has walked back to the return door trigger in the hallway
                
                const currentRoomElement = document.getElementById('Room-' + currentRoomId);
                const roomX = parseInt(currentRoomElement.style.left) + ROOM_WIDTH / 2; // Hallway Center X
                const roomY = parseInt(currentRoomElement.style.top) + ROOM_HEIGHT / 2; // Hallway Center Y
                
                const distanceToReturn = Math.sqrt(
                    Math.pow(cameraWorldX - roomX, 2) + 
                    Math.pow(cameraWorldY - roomY, 2)
                );
                
                if (distanceToReturn < RETURN_DOOR_RADIUS) {
                    // Walked back to the center trigger point
                    goToScene('Spawn', SPAWN_COORD.x, SPAWN_COORD.y);
                }
            }
        }

        // --- Global Event Listeners (E key for fast return) ---
        window.addEventListener('keydown', (e) => {
            // WASD Movement
            if (movementKeys.includes(e.code)) {
                if (!keyMap[e.code]) { currentSpeed = baseSpeed; }
                keyMap[e.code] = true;
                e.preventDefault();
            }
            
            // E key fast return trigger
            if (e.code === 'KeyE' && currentRoomId !== 'Spawn') {
                 goToScene('Spawn', SPAWN_COORD.x, SPAWN_COORD.y);
            }
        });

        window.addEventListener('keyup', (e) => {
            if (movementKeys.includes(e.code)) {
                keyMap[e.code] = false;
            }
            if (!Object.values(keyMap).some(v => v === true)) { 
                currentSpeed = baseSpeed;
            }
        });

        // --- Initialization and Animation ---
        
        function initializePosition() {
            loadRoomTemplates();

            const viewportCenterX = window.innerWidth / 2;
            const viewportCenterY = window.innerHeight / 2;
            
            // Initial position centers the 2500, 2350 point of the world (Spawn Room Center)
            currentX = targetX = viewportCenterX - SPAWN_COORD.x;
            currentY = targetY = viewportCenterY - SPAWN_COORD.y;
            world.style.transform = `translate3d(${currentX}px, ${currentY}px, 0)`;

            // Ensure only the spawn room is visible initially
            setRoomVisibility('Spawn');
            window.addEventListener('resize', initializePosition);
        }

        function animate() {
            // 1. Update target based on WASD keys
            if (!isTransitioning) {
                if (Object.values(keyMap).some(v => v === true)) {
                    currentSpeed = Math.min(maxSpeed, currentSpeed * accelerationRate);
                } else {
                    currentSpeed = baseSpeed;
                }
                
                if (keyMap['KeyA'] || keyMap['ArrowLeft']) { targetX += currentSpeed; }
                if (keyMap['KeyD'] || keyMap['ArrowRight']) { targetX -= currentSpeed; }
                if (keyMap['KeyW'] || keyMap['ArrowUp']) { targetY += currentSpeed; }
                if (keyMap['KeyS'] || keyMap['ArrowDown']) { targetY -= currentSpeed; }
            }
            
            // 2. Apply Easing
            const dx = targetX - currentX;
            const dy = targetY - currentY;
            
            currentX += dx * easing;
            currentY += dy * easing;

            // 3. Apply the new position
            world.style.transform = `translate3d(${Math.round(currentX)}px, ${Math.round(currentY)}px, 0)`;
            
            // 4. Check for room transitions
            checkCollisions();

            window.requestAnimationFrame(animate);
        }

        // --- Start Execution ---
        window.onload = initializePosition;
        animate();
    </script>
    
</body>
</html>
